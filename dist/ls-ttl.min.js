const t=window.localStorage,e={};function i(t){return t+"Item"}function n(t,i=""){return i+(e[t]||t)}export default class{constructor(t={}){this.options={keyPrefix:t.keyPrefix||"ls-",ttlSuffix:t.ttlSuffix||"-ls-ttl",encrypt:t.encrypt||null}}set(e,o,s=0){e=n(e,this.options.keyPrefix);const r=i("set");o&&"string"!=typeof o&&(o=this._stringify(o)),t[r](e,o),s>0&&t[r](e+this.options.ttlSuffix,(Date.now()+1e3*s).toString())}setWithRandomKey(t,i,o=0){const s=n(t,this.options.keyPrefix);return e[t]=s||function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length;let n="";for(let o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*i));return n}(16),this.set(e[t],i,o)}setWithEncryptedKey(t,i,n=0){return e[t]=this.options.encrypt?this.options.encrypt(t):btoa(t),this.set(e[t],i,n)}get(e,o=!1){let s=n(e,this.options.keyPrefix);const r=i("get"),f=this.isTTLKey(s),l=f?parseInt(t[r](s),10):this.getTTL(e);if(l&&l<Date.now())return s=f?s.replace(this.options.ttlSuffix,""):s,void this.delete(s);let h=t[r](s);return o&&this.delete(s),h}isTTLKey(t){return new RegExp(this.options.ttlSuffix+"$").test(t)}getTTL(e){e=n(e,this.options.keyPrefix);let o=t[i("get")](e+this.options.ttlSuffix);return o?parseInt(o,10):0}delete(...o){const s=i("remove");o.forEach((i=>{let o=n(i,this.options.keyPrefix);t[s](o),t[s](o+this.options.ttlSuffix),delete e[i]}))}_stringify(t){return t?"function"==typeof t.stringify?t.stringify():"object"==typeof t?JSON.stringify(t):"function"==typeof t.toString?t.toString():t:""}}
