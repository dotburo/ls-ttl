{"version":3,"file":"browser.js","sources":["../src/helpers.js","../src/index.js"],"sourcesContent":["const _IN_MEMORY_STORAGE = {};\n\n/**\n * Evaluate if the browser support usage of localStorage (eg. when Safari is set to block all cookies).\n * @return {boolean}\n */\nfunction checkSupport() {\n    try {\n        const key = '__random_tmp_key__';\n        window.localStorage.setItem(key, key);\n        window.localStorage.removeItem(key);\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\n/**\n * Get the localStorage method name.\n * @param {string} name\n * @return {function<*>}\n */\nexport function getStorageMethod(name) {\n    if (checkSupport()) {\n        return window.localStorage[`${name}Item`].bind(window.localStorage)\n    }\n\n    switch (name) {\n        case 'get':\n            return (key) => _IN_MEMORY_STORAGE[key];\n        case 'set':\n            return (key, value) => _IN_MEMORY_STORAGE[key] = value;\n        case 'remove':\n            return (key) => delete _IN_MEMORY_STORAGE[key];\n    }\n}\n","import {getStorageMethod} from './helpers';\n\nconst _KEY_PREFIX = 'ls-',\n    _TTL_SUFFIX = '-ls-ttl';\n\n/** LocalStorage client with TTL. */\nexport default class Ls {\n    constructor(options = {}) {\n        this.options = {\n            keyPrefix: options.keyPrefix || _KEY_PREFIX,\n            ttlSuffix: options.ttlSuffix || _TTL_SUFFIX,\n            encrypt: options.encrypt || null,\n        }\n    }\n\n    /**\n     * Add an entry to the persistent storage.\n     * @param {string} key\n     * @param {*} value         Number or string-convertible data\n     * @param {number} ttl      Time to live in seconds\n     */\n    set(key, value, ttl = 0) {\n        key = this.makeKey(key);\n\n        if (value && typeof value !== 'string') {\n            value = this._stringify(value);\n        }\n\n        getStorageMethod('set')(key, value);\n\n        if (ttl > 0) {\n            getStorageMethod('set')(key + this.options.ttlSuffix, (Date.now() + (ttl * 1000)).toString());\n        }\n    }\n\n    /**\n     * Get a value from the persistent storage.\n     * @param {string} key\n     * @param {boolean} forget\n     * @return {string|number}\n     */\n    get(key, forget = false) {\n        let key2 = this.makeKey(key);\n\n        const isTTLKey = this.isTTLKey(key2),\n            ttl = !isTTLKey ? this.getTTL(key) : parseInt(getStorageMethod('get')(key2), 10);\n\n        if (ttl && ttl < Date.now()) {\n            key2 = isTTLKey ? key2.replace(this.options.ttlSuffix, '') : key2;\n            this.delete(key2);\n            return void 0;\n        }\n\n        let value = getStorageMethod('get')(key2);\n\n        if (forget) {\n            this.delete(key);\n        }\n\n        try {\n            return JSON.parse(value);\n        } catch (error) {\n            return value;\n        }\n    }\n\n    /**\n     * Return the matching key with the prefix.\n     * @param {string} key\n     * @param {string} prefix\n     * @return {string}\n     * @private\n     */\n    makeKey(key, prefix = '') {\n        return this.options.keyPrefix\n            + (typeof this.options.encrypt === 'function' ? this.options.encrypt(key) : key);\n    }\n\n    /**\n     * Check if given key is a TTL key.\n     * @param {string} key\n     * @return {boolean}\n     */\n    isTTLKey(key) {\n        return (new RegExp(`${this.options.ttlSuffix}$`)).test(key)\n    }\n\n    /**\n     * Get the TTL of a saved value.\n     * @param {string} key\n     * @return {number}\n     */\n    getTTL(key) {\n        key = this.makeKey(key);\n\n        let ttl = getStorageMethod('get')(key + this.options.ttlSuffix);\n\n        if (!ttl) {\n            return 0;\n        }\n\n        return parseInt(ttl, 10);\n    }\n\n    /**\n     * Remove an entry from the persistent storage.\n     * @param {string|string[]} keys\n     */\n    delete(...keys) {\n        const rm = getStorageMethod('remove');\n\n        keys.forEach(key => {\n            key = this.makeKey(key);\n            rm(key);\n            rm(key + this.options.ttlSuffix);\n        });\n    }\n\n    /**\n     * Convert given value to a string.\n     * @param {*} value\n     * @return {string|Number}\n     * @private\n     */\n    _stringify(value) {\n        // Make sure we do not save `undefined` or `null` as string.\n        // LocalStorage only saves and returns strings.\n        if (!value) return '';\n\n        if (typeof value.stringify === 'function') return value.stringify();\n\n        if (typeof value === 'object') return JSON.stringify(value);\n\n        if (typeof value.toString === 'function') return value.toString();\n\n        return value;\n    }\n}\n"],"names":[],"mappings":"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"}